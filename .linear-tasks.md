# FlowLlama - Linear Tasks Structure

## Project: FlowLlama
**Description**: Ollama As A Service - Multi-cloud platform for deploying open-source LLM models with automatic cost optimization

---

## Epic 1: Infrastructure Foundation üèóÔ∏è
**Goal**: Base infrastructure always deployed across AWS and GCP

### Tasks:

#### INFRA-001: Create AWS VPC Terraform Module
- **Priority**: High
- **Labels**: `infrastructure`, `terraform`, `aws`, `networking`
- **Description**:
  - Create reusable VPC module for AWS
  - Include public/private subnets across multiple AZs
  - NAT Gateway, Internet Gateway
  - VPC Flow Logs for security monitoring
  - Support for multi-region replication
- **Acceptance Criteria**:
  - [ ] Module follows repository standards (main.tf, variables.tf, outputs.tf, README.md)
  - [ ] Includes basic and advanced examples
  - [ ] Supports configurable CIDR blocks
  - [ ] Properly tagged resources

#### INFRA-002: Create GCP VPC Terraform Module
- **Priority**: High
- **Labels**: `infrastructure`, `terraform`, `gcp`, `networking`
- **Description**:
  - Create reusable VPC module for GCP
  - Regional subnets with secondary IP ranges
  - Cloud NAT configuration
  - Firewall rules for Ollama instances
  - VPC Flow Logs
- **Acceptance Criteria**:
  - [ ] Global VPC with regional subnets
  - [ ] Cloud NAT configured
  - [ ] Examples included
  - [ ] Follows naming conventions

#### INFRA-003: Security Groups and Firewall Rules Modules
- **Priority**: High
- **Labels**: `infrastructure`, `security`, `terraform`, `multi-cloud`
- **Description**:
  - AWS Security Groups module for Ollama instances
  - GCP Firewall Rules module
  - Allow only necessary ports (Ollama API: 11434)
  - SSH access for debugging (restricted IPs)
- **Acceptance Criteria**:
  - [ ] Minimal access principle
  - [ ] Separate rules for different environments
  - [ ] Support for IP whitelisting

#### INFRA-004: IAM Roles and Service Accounts Module
- **Priority**: Medium
- **Labels**: `infrastructure`, `security`, `iam`, `multi-cloud`
- **Description**:
  - IAM roles for EC2 instances (AWS)
  - Service accounts for GCE instances (GCP)
  - Permissions for deployment agent
  - CloudWatch/Cloud Monitoring permissions
- **Acceptance Criteria**:
  - [ ] Least privilege access
  - [ ] Separate roles for agent vs instances
  - [ ] Documented permissions

---

## Epic 2: Terraform Modules üì¶
**Goal**: Reusable modules for deploying Ollama infrastructure

### Tasks:

#### MODULE-001: AWS Launch Template Module ‚úÖ
- **Status**: COMPLETED
- **Labels**: `terraform`, `aws`, `compute`
- **Description**: EC2 Launch Template with GPU support, IMDSv2, multi-region replication

#### MODULE-002: GCP Instance Template Module ‚úÖ
- **Status**: COMPLETED
- **Labels**: `terraform`, `gcp`, `compute`
- **Description**: GCE Instance Template with GPU support, Shielded VM, Spot VM support

#### MODULE-003: AWS Auto Scaling Group Module
- **Priority**: Medium
- **Labels**: `terraform`, `aws`, `scaling`
- **Description**:
  - Auto Scaling Group module
  - Integration with Launch Template
  - Dynamic scaling based on demand
  - Support for Spot instances
  - Health checks and replacement policies
- **Acceptance Criteria**:
  - [ ] Configurable min/max/desired capacity
  - [ ] Spot instance support
  - [ ] Integration with ALB/NLB

#### MODULE-004: GCP Instance Group Manager Module
- **Priority**: Medium
- **Labels**: `terraform`, `gcp`, `scaling`
- **Description**:
  - Managed Instance Group module
  - Integration with Instance Template
  - Auto-scaling policies
  - Support for Spot VMs
- **Acceptance Criteria**:
  - [ ] Regional or zonal MIG support
  - [ ] Auto-healing configuration
  - [ ] Integration with Load Balancer

#### MODULE-005: Load Balancer Modules
- **Priority**: Medium
- **Labels**: `terraform`, `networking`, `load-balancer`, `multi-cloud`
- **Description**:
  - AWS ALB/NLB module
  - GCP Cloud Load Balancer module
  - Health checks for Ollama endpoints
  - SSL/TLS termination
- **Acceptance Criteria**:
  - [ ] HTTP/HTTPS support
  - [ ] Health check on /api/tags endpoint
  - [ ] Cross-zone load balancing

#### MODULE-006: Storage Modules for LLM Models
- **Priority**: Medium
- **Labels**: `terraform`, `storage`, `multi-cloud`
- **Description**:
  - S3 bucket module (AWS)
  - Cloud Storage bucket module (GCP)
  - Store pre-pulled Ollama models
  - Lifecycle policies for cost optimization
- **Acceptance Criteria**:
  - [ ] Versioning enabled
  - [ ] Encryption at rest
  - [ ] Cost-optimized storage classes

---

## Epic 3: Backend API üîß
**Goal**: API to manage deployments, users, and pricing

### Tasks:

#### BACKEND-001: Backend Architecture Design
- **Priority**: High
- **Labels**: `backend`, `architecture`, `design`
- **Description**:
  - Define tech stack (Node.js/Python/Go)
  - Database choice (PostgreSQL/MongoDB)
  - API design (REST/GraphQL)
  - Authentication strategy
  - Deployment strategy
- **Deliverables**:
  - [ ] Architecture diagram
  - [ ] Tech stack decision document
  - [ ] API endpoint specification
  - [ ] Database schema design

#### BACKEND-002: User Authentication API
- **Priority**: High
- **Labels**: `backend`, `auth`, `api`
- **Description**:
  - User registration endpoint
  - Login/logout endpoints
  - JWT token generation and validation
  - Password reset flow
  - OAuth integration (optional)
- **Acceptance Criteria**:
  - [ ] POST /api/auth/register
  - [ ] POST /api/auth/login
  - [ ] POST /api/auth/logout
  - [ ] Secure password hashing
  - [ ] Token refresh mechanism

#### BACKEND-003: Deployment Configuration Endpoints
- **Priority**: High
- **Labels**: `backend`, `api`, `core`
- **Description**:
  - POST /api/deployments - Create new deployment
  - GET /api/deployments - List user deployments
  - GET /api/deployments/:id - Get deployment details
  - DELETE /api/deployments/:id - Stop/delete deployment
  - Request validation for model, memory, GPU requirements
- **Acceptance Criteria**:
  - [ ] Accept configuration: model, context_size, spot_tolerance
  - [ ] Validate against available models
  - [ ] Queue deployment request
  - [ ] Return deployment ID

#### BACKEND-004: Multi-Cloud Pricing API
- **Priority**: Medium
- **Labels**: `backend`, `pricing`, `multi-cloud`, `optimization`
- **Description**:
  - Integration with AWS Pricing API
  - Integration with GCP Cloud Billing API
  - Calculate cost for given configuration
  - Recommend cheapest cloud provider
  - Cache pricing data
- **Acceptance Criteria**:
  - [ ] GET /api/pricing/estimate
  - [ ] Real-time pricing data
  - [ ] Support for spot/preemptible pricing
  - [ ] Caching layer (15-min TTL)

#### BACKEND-005: Deployments Database Schema
- **Priority**: High
- **Labels**: `backend`, `database`
- **Description**:
  - Users table (id, email, password_hash, created_at)
  - Deployments table (id, user_id, model, instance_type, cloud_provider, status, url, cost)
  - Models table (id, name, min_ram, min_vram, context_size)
  - Instances table (id, deployment_id, instance_id, ip_address, status)
- **Acceptance Criteria**:
  - [ ] Migration scripts
  - [ ] Indexes on frequently queried fields
  - [ ] Foreign key constraints

#### BACKEND-006: Instance Health Monitoring
- **Priority**: Medium
- **Labels**: `backend`, `monitoring`, `health-check`
- **Description**:
  - Poll Ollama instances for health
  - Update deployment status in database
  - Detect failed instances
  - Trigger auto-healing if needed
- **Acceptance Criteria**:
  - [ ] Health check every 30 seconds
  - [ ] HTTP GET to /api/tags
  - [ ] Update status: healthy/unhealthy/terminated
  - [ ] Webhook to notify users

---

## Epic 4: Deployment Agent ü§ñ
**Goal**: Orchestrator that deploys Ollama instances based on user requests

### Tasks:

#### AGENT-001: Deployment Agent Architecture Design
- **Priority**: High
- **Labels**: `agent`, `architecture`, `design`
- **Description**:
  - Event-driven architecture (SQS/Pub-Sub)
  - Worker pool for parallel deployments
  - State machine for deployment lifecycle
  - Error handling and retry logic
  - Integration points with Backend and Terraform
- **Deliverables**:
  - [ ] Architecture diagram
  - [ ] State machine design
  - [ ] Queue structure definition

#### AGENT-002: Terraform Integration Layer
- **Priority**: High
- **Labels**: `agent`, `terraform`, `automation`
- **Description**:
  - Execute terraform init/plan/apply/destroy
  - Generate dynamic .tf files from deployment config
  - Parse terraform outputs (instance IP, URL)
  - Handle terraform state management
  - Rollback on failures
- **Acceptance Criteria**:
  - [ ] Isolated terraform workspaces per deployment
  - [ ] Capture outputs (public_ip, instance_id)
  - [ ] Cleanup on failure

#### AGENT-003: Cloud Provider Selection Logic
- **Priority**: Medium
- **Labels**: `agent`, `optimization`, `cost`, `multi-cloud`
- **Description**:
  - Query pricing API for user requirements
  - Compare AWS vs GCP costs
  - Consider spot/preemptible availability
  - Select cheapest option
  - Fallback if first choice fails
- **Acceptance Criteria**:
  - [ ] Price comparison algorithm
  - [ ] Spot availability check
  - [ ] User override option
  - [ ] Logging of selection rationale

#### AGENT-004: Instance Lifecycle Management
- **Priority**: High
- **Labels**: `agent`, `lifecycle`, `orchestration`
- **Description**:
  - Create: Provision instance via Terraform
  - Monitor: Health checks and status updates
  - Update: Handle configuration changes
  - Destroy: Clean teardown of resources
  - Auto-healing: Replace failed instances
- **Acceptance Criteria**:
  - [ ] State transitions documented
  - [ ] Idempotent operations
  - [ ] Graceful shutdown
  - [ ] Resource cleanup verification

#### AGENT-005: Deployment Queue System
- **Priority**: Medium
- **Labels**: `agent`, `queue`, `async`, `scalability`
- **Description**:
  - SQS (AWS) or Pub/Sub (GCP) integration
  - Message schema for deployment requests
  - Priority queue for paid vs free tier
  - Dead letter queue for failures
  - Concurrency controls
- **Acceptance Criteria**:
  - [ ] Messages processed FIFO per user
  - [ ] Retry logic (3 attempts)
  - [ ] DLQ monitoring

#### AGENT-006: Ollama Installation and Configuration
- **Priority**: High
- **Labels**: `agent`, `ollama`, `automation`, `provisioning`
- **Description**:
  - User-data/startup script templates
  - Install Ollama via curl script
  - Pull requested model during boot
  - Configure systemd service
  - Setup logging and monitoring agents
  - Expose API on port 11434
- **Acceptance Criteria**:
  - [ ] Idempotent installation script
  - [ ] Model pre-pulling from S3/GCS cache
  - [ ] Health endpoint accessible
  - [ ] Logs sent to CloudWatch/Cloud Logging

---

## Epic 5: Frontend üé®
**Goal**: User-friendly web interface

### Tasks:

#### FRONTEND-001: UI/UX Design
- **Priority**: Medium
- **Labels**: `frontend`, `design`, `ux`
- **Description**:
  - Wireframes for main pages
  - Dashboard mockups
  - Deployment form design
  - Mobile responsiveness
  - Design system/component library
- **Deliverables**:
  - [ ] Figma/Sketch designs
  - [ ] Component library
  - [ ] User flow diagrams

#### FRONTEND-002: Frontend Project Setup
- **Priority**: Medium
- **Labels**: `frontend`, `setup`, `infrastructure`
- **Description**:
  - Initialize Next.js/React project
  - Setup TailwindCSS
  - Configure ESLint/Prettier
  - Setup folder structure
  - Environment configuration
- **Acceptance Criteria**:
  - [ ] Hot reload working
  - [ ] TypeScript configured
  - [ ] Git hooks for linting

#### FRONTEND-003: Deployment Configuration Form
- **Priority**: High
- **Labels**: `frontend`, `forms`, `core`
- **Description**:
  - Model selector dropdown (Llama 3, Mistral, Qwen, etc.)
  - Memory/context size slider
  - Spot instance tolerance toggle
  - GPU requirement selector
  - Real-time cost estimate display
- **Acceptance Criteria**:
  - [ ] Form validation
  - [ ] API integration
  - [ ] Loading states
  - [ ] Error handling

#### FRONTEND-004: Deployments Dashboard
- **Priority**: High
- **Labels**: `frontend`, `dashboard`, `core`
- **Description**:
  - Table of active deployments
  - Status indicators (running/pending/failed)
  - Instance details (IP, URL, cost)
  - Actions (stop, delete, restart)
  - Auto-refresh every 10 seconds
- **Acceptance Criteria**:
  - [ ] Real-time status updates
  - [ ] Copy URL to clipboard
  - [ ] Confirm before delete

#### FRONTEND-005: Real-Time Cost Estimator
- **Priority**: Medium
- **Labels**: `frontend`, `pricing`, `ux`
- **Description**:
  - Display estimated hourly cost
  - Show AWS vs GCP comparison
  - Monthly projection
  - Breakdown by resource type
- **Acceptance Criteria**:
  - [ ] Updates as user changes config
  - [ ] Clear pricing breakdown
  - [ ] Currency formatting

#### FRONTEND-006: Deployment Management UI
- **Priority**: Medium
- **Labels**: `frontend`, `management`
- **Description**:
  - Stop deployment button
  - Delete deployment with confirmation
  - View logs interface
  - Scale up/down (future)
- **Acceptance Criteria**:
  - [ ] Confirmation dialogs
  - [ ] Optimistic UI updates
  - [ ] Error notifications

---

## Epic 6: Platform & DevOps ‚öôÔ∏è
**Goal**: CI/CD, monitoring, and operational excellence

### Tasks:

#### DEVOPS-001: Backend CI/CD Pipeline
- **Priority**: Medium
- **Labels**: `devops`, `ci-cd`, `backend`
- **Description**:
  - GitHub Actions workflow
  - Run tests on PR
  - Build Docker image
  - Deploy to staging/production
  - Database migrations
- **Acceptance Criteria**:
  - [ ] Automated testing
  - [ ] Zero-downtime deployments
  - [ ] Rollback capability

#### DEVOPS-002: Frontend CI/CD Pipeline
- **Priority**: Medium
- **Labels**: `devops`, `ci-cd`, `frontend`
- **Description**:
  - Build optimization
  - Deploy to Vercel/Netlify/S3+CloudFront
  - Preview deployments for PRs
  - Cache busting
- **Acceptance Criteria**:
  - [ ] Build time < 2 minutes
  - [ ] CDN distribution
  - [ ] Preview URLs

#### DEVOPS-003: Monitoring and Observability
- **Priority**: Low
- **Labels**: `devops`, `monitoring`, `observability`
- **Description**:
  - CloudWatch/Cloud Monitoring dashboards
  - Alert on instance failures
  - Cost monitoring and alerts
  - Performance metrics (latency, throughput)
- **Acceptance Criteria**:
  - [ ] Grafana/Datadog dashboard
  - [ ] PagerDuty/Slack alerts
  - [ ] SLO tracking

#### DEVOPS-004: Centralized Logging
- **Priority**: Low
- **Labels**: `devops`, `logging`
- **Description**:
  - Aggregate logs from Ollama instances
  - Backend API logs
  - Deployment agent logs
  - Searchable log interface
- **Acceptance Criteria**:
  - [ ] CloudWatch Logs Insights / Cloud Logging
  - [ ] Log retention policies
  - [ ] Query interface

---

## Epic 7: Research & Discovery üî¨
**Goal**: Model catalog and infrastructure benchmarking

### Tasks:

#### RESEARCH-001: Open Source Model Catalog
- **Priority**: High
- **Labels**: `research`, `models`, `ml`
- **Description**:
  - Research popular open source models
  - Llama 3/3.1/3.2 variants
  - Mistral 7B/24B
  - Qwen 2.5
  - DeepSeek models
  - Capabilities and use cases
- **Deliverables**:
  - [ ] Model comparison spreadsheet
  - [ ] Recommended models for MVP

#### RESEARCH-002: Hardware Requirements Mapping
- **Priority**: High
- **Labels**: `research`, `hardware`, `optimization`
- **Description**:
  - Map each model to minimum specs
  - RAM requirements (8GB, 16GB, 32GB, 64GB)
  - VRAM for GPU models (T4, A100, L4)
  - CPU requirements
  - Context window impact on memory
- **Deliverables**:
  - [ ] Requirements matrix
  - [ ] Instance type recommendations

#### RESEARCH-003: AWS vs GCP Cost Benchmarking
- **Priority**: Medium
- **Labels**: `research`, `pricing`, `benchmarking`, `cost-optimization`
- **Description**:
  - Compare GPU instance pricing
  - Spot vs on-demand pricing
  - Network egress costs
  - Storage costs
  - Regional pricing differences
- **Deliverables**:
  - [ ] Cost comparison spreadsheet
  - [ ] Recommendation algorithm inputs

---

## Next Steps After Task Creation:

1. **Prioritize Epic 1 (Infrastructure) + Epic 7 (Research)** - Week 1
2. **Kick off Epic 3 (Backend) + Epic 2 (remaining modules)** - Week 2
3. **Start Epic 4 (Agent)** - Week 3
4. **Begin Epic 5 (Frontend)** - Week 4
5. **Epic 6 (DevOps)** - Ongoing from Week 2

---

**Total Initial Tasks**: 35 tasks across 7 epics
